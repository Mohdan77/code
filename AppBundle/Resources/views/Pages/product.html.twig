{% extends '@PostroykaApp/base.html.twig' %}

{% set meta_add = {} %}


{% block headline %}{% endblock %}


{% block content %}
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1"
         xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs>
            <symbol id="svg-reviews" viewBox="0 0 32 32">
                <title>reviews</title>
                <path d="M12.926 6.926c-7.139 0-12.926 4.446-12.926 9.944 0 2.69 1.398 5.136 3.662 6.923-0.138 1.826-0.574 4.059-1.848 5.264 2.536 0 5.12-1.582 6.762-2.827 1.36 0.378 2.826 0.582 4.35 0.582 7.136 0 12.928-4.458 12.928-9.944-0.002-5.496-5.792-9.942-12.928-9.942v0z"></path>
                <path d="M30.115 17.83c1.088-1.448 1.709-3.134 1.709-4.942 0-5.498-5.787-9.944-12.928-9.944-3.146 0-6.030 0.864-8.266 2.291 1.050-0.194 2.158-0.301 3.296-0.301 7.678 0 13.917 4.896 13.917 10.934 0 2.381-0.963 4.586-2.603 6.382 1.632 1.242 4.226 2.835 6.76 2.835-1.806-1.71-1.934-5.506-1.885-7.256v0z"></path>
            </symbol>
            <symbol id="svg-files" viewBox="0 0 32 32">
                <title>files</title>
                <path d="M18.090 13.426c-0.558 0-1.030-0.195-1.418-0.582-0.389-0.39-0.582-0.862-0.582-1.418v-11.334h-11.334c-0.555 0-1.027 0.195-1.418 0.584-0.389 0.387-0.582 0.861-0.582 1.416v28c0 0.557 0.195 1.030 0.582 1.418 0.39 0.389 0.862 0.582 1.418 0.582h22.667c0.555 0 1.027-0.194 1.416-0.582s0.582-0.861 0.582-1.418v-16.666h-11.331zM24.088 26.093c0 0.194-0.062 0.354-0.187 0.478s-0.285 0.187-0.48 0.187h-14.667c-0.194 0-0.354-0.062-0.478-0.187s-0.187-0.285-0.187-0.478v-1.334c0-0.194 0.062-0.354 0.187-0.48 0.125-0.123 0.285-0.186 0.478-0.186h14.667c0.195 0 0.355 0.062 0.48 0.186 0.125 0.126 0.187 0.286 0.187 0.48v1.334zM24.088 20.758c0 0.195-0.062 0.355-0.187 0.48s-0.285 0.187-0.48 0.187h-14.667c-0.194 0-0.354-0.062-0.478-0.187s-0.187-0.285-0.187-0.48v-1.333c0-0.195 0.062-0.355 0.187-0.478 0.125-0.126 0.285-0.189 0.478-0.189h14.667c0.195 0 0.355 0.062 0.48 0.189 0.125 0.123 0.187 0.283 0.187 0.478v1.333z"></path>
                <path d="M28.005 8.008l-6.501-6.499c-0.694-0.696-1.611-1.146-2.752-1.355v10.603h10.606c-0.208-1.138-0.659-2.054-1.354-2.749v0z"></path>
            </symbol>
            <symbol id="svg-master" viewBox="0 0 32 32">
                <title>master</title>
                <path d="M30.416 26.561c-3.2-1.684-5.646-2.619-7.82-2.987l0.234-0.325c0.094-0.128 0.125-0.29 0.086-0.441l-0.496-1.981c1.328-1.87 2.109-4.208 2.109-6.424v-2.134h1.601c0.296 0 0.534-0.238 0.534-0.533 0.002-0.296-0.237-0.534-0.533-0.534h-0.533v-0.533c0-1.486-0.35-2.885-0.976-4.13l-4.789 0.92c-0.034 0.006-0.067 0.010-0.101 0.010-0.14 0-0.275-0.056-0.377-0.155-0.125-0.125-0.179-0.304-0.146-0.478l0.875-4.592c-0.451-0.203-0.923-0.379-1.418-0.518v-0.117c-0.002-0.886-0.723-1.608-1.611-1.608h-2.115c-0.888 0-1.61 0.722-1.61 1.608v0.114c-0.493 0.141-0.965 0.315-1.416 0.52l0.874 4.592c0.034 0.173-0.022 0.352-0.147 0.477-0.101 0.101-0.237 0.157-0.376 0.157-0.034 0-0.067-0.003-0.101-0.010l-4.789-0.922c-0.627 1.245-0.978 2.645-0.978 4.131v0.533h-0.533c-0.294 0-0.534 0.238-0.534 0.533s0.238 0.533 0.533 0.533h1.6v2.134c0 2.216 0.786 4.554 2.11 6.424l-0.494 1.981c-0.038 0.153-0.006 0.313 0.086 0.441l0.237 0.325c-2.173 0.37-4.621 1.306-7.819 2.989-0.978 0.514-1.586 1.521-1.586 2.625v2.283c0 0.293 0.238 0.532 0.533 0.532l17.91-0.005c0.008 0 0.016 0.005 0.023 0.005h13c0.296 0 0.534-0.237 0.534-0.532v-2.283c0-1.104-0.606-2.111-1.584-2.625h0.003zM8.533 14.4v-2.133h14.933v2.133c0 2.402-0.85 4.515-2.106 6.101-0.019 0.019-0.043 0.030-0.059 0.050-0.184 0.234-0.373 0.456-0.568 0.664-0.002 0.002-0.002 0.003-0.002 0.003-0.131 0.138-0.265 0.259-0.398 0.384-1.305 1.176-2.854 1.866-4.331 1.866s-3.027-0.69-4.331-1.866c-0.134-0.125-0.269-0.246-0.398-0.384-0.002-0.002-0.002-0.002-0.003-0.003-0.195-0.208-0.386-0.43-0.57-0.664-0.016-0.021-0.040-0.031-0.059-0.050-1.255-1.586-2.107-3.699-2.108-6.101v0zM10.178 22.82l0.238-0.956c0.002 0.002 0.003 0.003 0.003 0.003 1.29 1.402 2.93 2.39 4.778 2.615 0 0 0.002 0 0.003 0l-1.448 3.257-3.574-4.919zM18.245 27.739l-1.446-3.257c0.002 0 0.002 0 0.003 0 1.849-0.226 3.49-1.213 4.778-2.615 0 0 0.002-0.002 0.003-0.003l0.237 0.956-3.575 4.919z"></path>
                <path d="M21.072 2.758l-0.668 3.501 3.648-0.701c-0.754-1.125-1.769-2.080-2.98-2.8z"></path>
                <path d="M10.93 2.758c-1.211 0.72-2.224 1.674-2.982 2.8l3.65 0.702-0.668-3.502z"></path>
            </symbol>
            <symbol id="svg-text" viewBox="0 0 32 32">
                <title>text</title>
                <path d="M0 23.675h19.2v3.2h-19.2v-3.2z"></path>
                <path d="M0 10.875h20.8v3.2h-20.8v-3.2z"></path>
                <path d="M24 10.875h8v3.2h-8v-3.2z"></path>
                <path d="M28.8 23.675h3.2v3.2h-3.2v-3.2z"></path>
                <path d="M22.4 23.675h3.2v3.2h-3.2v-3.2z"></path>
                <path d="M0 4.475h3.859v3.2h-3.859v-3.2z"></path>
                <path d="M7.058 4.475h3.176v3.2h-3.176v-3.2z"></path>
                <path d="M13.433 4.475h18.567v3.2h-18.567v-3.2z"></path>
                <path d="M0 17.275h5.458v3.199h-5.458v-3.199z"></path>
                <path d="M8.658 17.275h23.342v3.199h-23.342v-3.199z"></path>
            </symbol>
        </defs>
    </svg>


    <div class="product_section" itemscope itemtype="http://schema.org/Product">
        <div class="_row">
            <div class="col_full">
                <div class="product-image_blk">
                    <div class="_row">
                        <div class="col_12">
                            <div class="{% if page.image and not page.images %}image{% endif%} -shadow_default {% if page.images %}pr-im{% endif %}">
                                {% if page.value('stock') %}
                                    <div class="product_label" data-type="stock" data-size="big">Акция</div>
                                {% elseif page.value('novelty') %}
                                    <div class="product_label" data-type="novelty" data-size="big">Новинка</div>
                                {% elseif page.value('markdown') %}
                                    <div class="product_label" data-type="markdown" data-size="big">Уценка</div>
                                {% elseif page.value('supershare') %}
                                    <div class="product_label supershare" data-type="supershare" data-size="big">
                                        Суперакция
                                    </div>
                                {% elseif page.value('sales_leader') %}
                                    <div class="product_label sales_leader" data-type="sales_leader" data-size="big">
                                        Лидер продаж
                                    </div>
                                {% endif %}
                                 {% if page.image and not page.images %}
                                    <a href="{{ asset(page.image) }}"
                                       class="_ico-zoom js-product-img-lightbox"
                                       title="{{ page.title }}"
                                       {% if page.value('color_code') %}data-color="{{ page.value('color_code') }}"{% endif %}></a>
                                    <a href="{{ asset(page.image) }}"
                                       class="js-product-img-lightbox"
                                       title="{{ page.title }} От 1-ого поставщика."
                                       {% if page.value('color_code') %}data-color="{{ page.value('color_code') }}"{% endif %}>
                                        <picture class="img">
                                            <source srcset="{{ asset(page.image)|imagine_filter('product_s') }}"
                                                    media="(max-width: 1024px)">
                                            <source srcset="{{ asset(page.image)|imagine_filter('product') }}"
                                                    media="(max-width: 768px)">
                                            <img src="{{ asset(page.image)|imagine_filter('product') }}"
                                                 itemprop="image"
                                                 title="{{ page.title }} От 1-ого поставщика."
                                                 alt="{{ page.title }}">
                                        </picture>
                                        {% if page.value('color_code') %}
                                            <div class="color"
                                                 style="background-color: {{ page.value('color_code') }}"></div>
                                        {% endif %}
                                    </a>{% endif %}
                                 {% if  page.images and page.image %}
                                     <div id="sync1"
                                          class="pr-slider owl-carousel">
                                         <div class="item js-product-img-lightbox">
                                            <a href="{{ asset(page.image) }}"
                                               class="_ico-zoom js-product-img-lightbox"
                                               title="{{ page.title }}"
                                               {% if page.value('color_code') %}data-color="{{ page.value('color_code') }}"{% endif %}></a>
                                             <img src="{{ asset(page.image)}}"
                                                  itemprop="image"
                                                  title="{{ page.title }} От 1-ого поставщика."
                                                  alt="{{ page.title }}">
                                         </div>
                                         {% for image in page.getImages() %}
                                             <div class="item js-product-img-lightbox">
                                                 <a href="{{ asset(page.image) }}"
                                                    class="_ico-zoom js-product-img-lightbox"
                                                    title="{{ page.title }}"
                                                    {% if page.value('color_code') %}data-color="{{ page.value('color_code') }}"{% endif %}></a>
                                                 <img src="{{ asset(image.getPath())}}"
                                                      alt="{{ page.title }}"
                                                      title="{{ page.title }} От 1-ого поставщика.">
                                             </div>
                                         {% endfor %}
                                     </div>
                                     <div id="sync2"
                                          class="navigation-thumbs owl-carousel">
                                         <div class="item">
                                             <img src="{{ asset(page.image)|imagine_filter('gallery_thumb') }}"
                                                  itemprop="image"
                                                  title="{{ page.title }} От 1-ого поставщика."
                                                  alt="{{ page.title }}">
                                         </div>
                                         {% for image in page.getImages() %}
                                             <div class="item">
                                                 <img src="{{ asset(image.getPath())|imagine_filter('gallery_thumb') }}"
                                                      itemprop="image"
                                                      alt="{{ page.title }}"
                                                      title="{{ page.title }} От 1-ого поставщика.">
                                             </div>
                                         {% endfor %}
                                     </div>
                                 {% endif %}
                            </div>
                        </div>
                        <div class="col_12">
                            <div class="summary -shadow_default">
                                <div class="item">
                                    <h1 class="headline" itemprop="name">{{ page.value('h1')|default(page.title) }}</h1>
                                    <meta itemprop="description" content="{{ page.description }}">

                                    {% if page.value('rating') > 0 %}
                                        <div class="rating">
                                            <div itemprop="aggregateRating" itemscope
                                                 itemtype="http://schema.org/AggregateRating">

                                                <div class="c-rating-preview" data-value="{{ page.value('rating') }}">
                                                    <div class="_stars">
                                                        <div class="_active"></div>
                                                    </div>

                                                    <div class="_num">
                                                        Оценка: <span
                                                                itemprop="ratingValue">{{ page.value('rating') }}</span>
                                                        (<span itemprop="reviewCount">{{ page.value('reviews_count') }} {% if page.value('reviews_count') == 1 or page.value('reviews_count')
                                                                == 21 or page.value('reviews_count') == 31 or page.value('reviews_count')
                                                                == 41 %}отзыв{% elseif page.value('reviews_count') == 2 or page.value('reviews_count')
                                                                == 3 or page.value('reviews_count') == 4 or page.value('reviews_count')
                                                                == 22 or page.value('reviews_count') == 23 or page.value('reviews_count')
                                                                == 24 %}отзыва{% else %}отзывов{% endif %}</span>)
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="item" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                                    <meta itemprop="price" content="{{ page.price|number_format(2, '.', ' ') }}">
                                    <meta itemprop="priceCurrency" content="BYN">
                                    <link itemprop="availability" href="http://schema.org/InStock">

                                    <div class="price">
                                        {% if has_old_retail_price(page) %}
                                            <div class="old-price">{{ old_retail_price(page) }}</div>
                                        {% endif %}

                                        <div class="base-price">{{ retail_price(page) }}</div>

                                        {% if has_wholesale_price(page) %}
                                            <div class="sale-price">от {{ wholesale_quantity(page) }}
                                                - {{ wholesale_price(page) }}</div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="item">
                                    <form action="{{ path('js_api', {'action': 'cart-add', 'id': page.id}) }}"
                                          method="post" data-id="{{ page.id }}">
                                        <div class="small_row">
                                            <div class="col_6">
                                                <div class="_counter">
                                                    <span class="_ico-minus"></span>
                                                    <input name="quantity" id="quantity" type="text" value="1">
                                                    <span class="_ico-plus"></span>
                                                </div>
                                            </div>

                                            <div class="col_6">
                                                <a href="#" class="send-cart orange_btn full-width_btn"
                                                   onclick="
                                                           yaCounter37953910.reachGoal('add_to_cart');
                                                           GTM_addItemToCart({
                                                           'name': '{{ page.title }}',
                                                           'id': '{{ page.id }}',
                                                           'price': '{{ page.price }}',
                                                           'quantity': 'quantity'
                                                           })">
                                                    <span class="_ico-cart"></span>В корзину
                                                </a>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                                {% if is_granted('ROLE_ADMIN') %}
                                    <div class="item">
                                        <a href="{{ path('submarine_pages_edit', {'id': page.id}) }}">Редактировать</a>
                                    </div>
                                {% endif %}

                                <div class="msg">Товар добавлен в корзину</div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="tabs_blk">
                    <div class="blk_head">
                        <ul class="tabs_nav">
                            <li class="sel">
                                <svg class="svg-ico svg-text">
                                    <use xlink:href="#svg-text"></use>
                                </svg>
                                <span>Описание товара</span>
                            </li>

                            {% if page.value('advice') %}
                                <li>
                                    <svg class="svg-ico svg-master">
                                        <use xlink:href="#svg-master"></use>
                                    </svg>
                                    <span>Совет мастера</span>
                                </li>
                            {% endif %}

                            {% if page.files|length %}

                                <li>
                                    <svg class="svg-ico svg-files">
                                        <use xlink:href="#svg-files"></use>
                                    </svg>
                                    <span>Файлы</span>
                                </li>
                            {% endif %}

                            <li>
                                <svg class="svg-ico svg-reviews">
                                    <use xlink:href="#svg-reviews"></use>
                                </svg>
                                <span>Отзывы ({{ page.value('reviews_count') }})</span>
                            </li>
                        </ul>
                    </div>


                    <div class="blk_body -shadow_default">
                        <div class="tab active">
                            <div class="description_blk">
                                {{ page.description }}
                            </div>
                           <div class="features_blk">
                                {% for property in properties %}
                                    <div class="_row">
                                        <div class="col_6">
                                            <div class="title">{{ property.property.title }}:</div>
                                        </div>

                                        <div class="col_6">
                                            <div class="content">{{ property.value }} {{ property.property.valuePostfix }}</div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            {% if page.value('video') %}
                                <div class="text_blk">
                                    {{ page.value('video')|raw }}
                                </div>
                            {% endif %}

                            <div class="text_blk">
                                {{ page.body|raw }}
                            </div>
                        </div>

                        {% if page.value('advice') %}
                            <div class="tab">
                                {{ page.value('advice')|raw }}
                            </div>
                        {% endif %}

                        {% if page.files|length %}
                            <div class="tab">
                                {{ include('@PostroykaApp/Pages/_files.html.twig') }}
                            </div>
                        {% endif %}

                        <div class="tab" data-type="review">
                            {{ include('@PostroykaApp/Pages/_reviews.html.twig') }}
                        </div>
                    </div>
                </div>


                {% if similar|length %}
                    <div class="related-catalog_blk">
                        <div class="blk_headline">Похожие товары:</div>
                        <div class="_catalog mini_catalog related_catalog">
                            <div class="_row">
                                {% for product in similar %}
                                    {{ include('@PostroykaApp/Pages/_product_item.html.twig', {'list': 'Похожие товары', 'position': loop.index}) }}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>


            <div class="col_3 hide1180">
                {% if related|length %}
                    <div class="-shadow_default related-products_blk">
                        <div class="blk_headline">Сопутствующие товары:</div>

                        {% for product in related %}
                            <div class="related_product">
                                <div class="image">
                                    <a href="{{ link(product.url) }}"
                                       title="{{ product.title }} От 1-ого поставщика."
                                       onclick="GTM_productClick({
                                               'name': '{{ product.title }}',
                                               'id': '{{ product.id }}',
                                               'price': '{{ product.price }}',
                                               'category': '{{ product.parentPages|first.title }}',
                                               'list': 'Сопутствующие товары',
                                               'position': {{ loop.index }}
                                               })">
                                        {% if product.image %}
                                            <img src="{{ asset(product.image)|imagine_filter('product_item_s') }}"
                                                 title="{{ product.title }} От 1-ого поставщика."
                                                 alt="{{ product.title }}">
                                        {% endif %}
                                    </a>
                                </div>

                                <div class="summary">
                                    <div class="item">
                                        <a href="{{ link(product.url) }}" class="headline"
                                           onclick="GTM_productClick({
                                                   'name': '{{ product.title }}',
                                                   'id': '{{ product.id }}',
                                                   'price': '{{ product.price }}',
                                                   'category': '{{ product.parentPages|first.title }}',
                                                   'list': 'Сопутствующие товары',
                                                   'position': {{ loop.index }}
                                                   })">
                                            {{ product.title }}</a>
                                    </div>

                                    <div class="item">
                                        <div class="price">
                                            <span>{{ retail_price(product) }}</span>
                                        </div>
                                    </div>

                                    <div class="item">
                                        <div class="related_count">
                                            <form action="{{ path('js_api', {'action': 'cart-add', 'id': product.id}) }}"
                                                  method="post" data-id="{{ product.id }}">
                                                <div class="_counter">
                                                    <span class="_ico-minus"></span>
                                                    <input name="quantity" id="quantity_{{ product.id }}" type="text"
                                                           value="1">
                                                    <span class="_ico-plus"></span>
                                                </div>
                                                <a href="#" class="send-cart" onclick="
                                                        yaCounter37953910.reachGoal('add_to_cart');
                                                        GTM_addItemToCart({
                                                        'name': '{{ product.title }}',
                                                        'id': '{{ product.id }}',
                                                        'price': '{{ product.price }}',
                                                        'category': '{{ product.parentPages|first.title }}',
                                                        'quantity': 'quantity_{{ product.id }}'
                                                        })">
                                                    <span class="_ico-cart"></span>
                                                </a>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}


{% block gtm_header %}
    {{ parent() }}

    {# GTM: Просмотр карточки товара #}
    <script>
        window.dataLayer = window.dataLayer || [];
        dataLayer.push({
            'ecommerce': {
                'currencyCode': 'USD',
                'detail': {
                    'actionField': {'list': ''},
                    'products': [{
                        'name': '{{ page.title }}',
                        'id': '{{ page.id }}',
                        'price': '{{ page.price }}'
                    }]
                },
                'impressions': [
                    {% for product in related|default %}
                    {
                        'name': '{{ product.title }}',
                        'id': '{{ product.id }}',
                        'price': '{{ product.price }}',
                        'list': 'Сопутствующие товары',
                        'category': '{{ product.parentPages|first.title }}',
                        'position': {{ loop.index }}
                    },
                    {% endfor %}
                ]
            },
            'event': 'gtm-ee-event',
            'gtm-ee-event-category': 'Enhanced Ecommerce',
            'gtm-ee-event-action': 'Product Details',
            'gtm-ee-event-non-interaction': 'True'
        });
    </script>
{% endblock %}
